# 阴阳师
***
阴阳师已经肝不动了，如果当年不是[青行灯](https://yys.163.com/shishen/266.html)的鼓励，我也坚持玩不了那么久。虽然已经弃坑，但是可以将各式神的资源下载回来作为idea的背景图啊

## 查找资源
通过[阴阳师官网](https://yys.163.com/)，我们可以一步步找到式神的[首页](https://yys.163.com/shishen/index.html)。
找到青行灯，[进入](https://yys.163.com/shishen/266.html)，F12后，我们发现有个地址获取了所有式神的数据`https://yys.res.netease.com/pc/zt/20161108171335/js/app/all_shishen.json?v53`
我们下载回来看一下
```js
curl https://yys.res.netease.com/pc/zt/20161108171335/js/app/all_shishen.json\?v53 -o all_shishen.json
```
我们看一下青行灯的数据，发现`id=266`，资源路径在`resource`，皮肤在skin，并且有两个皮肤
```json
{
    "id": "266",
    "level": "SSR",
    "name": "青行灯",
    "pc_gonglve": "24478",
    "pc_tongren": "24555",
    "m_gonglve": "24632",
    "m_tongren": "24709",
    "hasVideo": "true",
    "resource": "https://yys.res.netease.com/shishen/qingxingdengtr.zip",
    "title": "《阴阳师》手游式神录_式神青行灯_青行灯攻略_青行灯御魂搭配攻略_觉醒材料_在哪里刷_青行灯阵容搭配_《阴阳师》手游官网",
    "desc": "《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。",
    "keys": "阴阳师,手游,式神,青行灯,御魂,觉醒,攻略,培养,阵容,技能,资质,在哪里刷,升星,阴阳师式神,阴阳师下载,阴阳师官方下载,阴阳师安卓下载,阴阳师安卓官方下载,阴阳师手游,阴阳师礼包,阴阳师手游下载,阴阳师手游安卓, 阴阳师手游iOS,阴阳师手游苹果,阴阳师助手,网易手游,阴阳师手游 ios,阴阳师,阴阳师 ios,阴阳师手游ios,阴阳师手游安卓,阴阳师安卓,阴阳师 安卓,阴阳师ios,阴阳师 礼包,阴阳师礼包,阴阳师手游 安卓,阴阳师手游 礼包,阴阳师苹果,阴阳师攻略",
    "share_m": "《阴阳师》手游式神录——青行灯搭配使用攻略",
    "share_m_2": "《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。",
    "share": "《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。",
    "skin": [{
        "name": "幽蝶花舞",
        "originator": "红莲喵喵"
    }, {
        "name": "青灯夜话",
        "originator": null
    }]
}
```
我们分析一下网页上青行灯的各个图片路径的规律
- 初始 `https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_big_beforeAwake/266.png?v4`
- 觉醒 `https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_big_afterAwake/266.png?v4`
- 皮肤1 `https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_skin/266-1.png?v4`
- 皮肤2 `https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_skin/266-2.png?v4`

## js拼接下载资源
首先我们压缩一下刚才的[json文件](/yinyangshi/all_shishen.json)为一行，去[在线工具](https://tool.oschina.net/jscompress/)
```js
// 这里只放两个式神的数据测试
let array = [{"id":"266","level":"SSR","name":"青行灯","pc_gonglve":"24478","pc_tongren":"24555","m_gonglve":"24632","m_tongren":"24709","hasVideo":"true","resource":"https://yys.res.netease.com/shishen/qingxingdengtr.zip","title":"《阴阳师》手游式神录_式神青行灯_青行灯攻略_青行灯御魂搭配攻略_觉醒材料_在哪里刷_青行灯阵容搭配_《阴阳师》手游官网","desc":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","keys":"阴阳师,手游,式神,青行灯,御魂,觉醒,攻略,培养,阵容,技能,资质,在哪里刷,升星,阴阳师式神,阴阳师下载,阴阳师官方下载,阴阳师安卓下载,阴阳师安卓官方下载,阴阳师手游,阴阳师礼包,阴阳师手游下载,阴阳师手游安卓, 阴阳师手游iOS,阴阳师手游苹果,阴阳师助手,网易手游,阴阳师手游 ios,阴阳师,阴阳师 ios,阴阳师手游ios,阴阳师手游安卓,阴阳师安卓,阴阳师 安卓,阴阳师ios,阴阳师 礼包,阴阳师礼包,阴阳师手游 安卓,阴阳师手游 礼包,阴阳师苹果,阴阳师攻略","share_m":"《阴阳师》手游式神录——青行灯搭配使用攻略","share_m_2":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","share":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","skin":[{"name":"幽蝶花舞","originator":"红莲喵喵"},{"name":"青灯夜话","originator":null}]},{"id":"265","level":"SSR","name":"茨木童子","pc_gonglve":"23394","pc_tongren":"23398","m_gonglve":"23399","m_tongren":"23400","hasVideo":"true","resource":"https://yys.res.netease.com/shishen/cimutongzitr.zip","title":"《阴阳师》手游式神录_式神茨木童子_茨木童子攻略_茨木童子御魂搭配攻略_觉醒材料_在哪里刷_茨木童子阵容搭配_《阴阳师》手游官网","desc":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","keys":"阴阳师,手游,式神,茨木童子,御魂,觉醒,攻略,培养,阵容,技能,资质,在哪里刷,升星,阴阳师式神,阴阳师下载,阴阳师官方下载,阴阳师安卓下载,阴阳师安卓官方下载,阴阳师手游,阴阳师礼包,阴阳师手游下载,阴阳师手游安卓, 阴阳师手游iOS,阴阳师手游苹果,阴阳师助手,网易手游,阴阳师手游 ios,阴阳师,阴阳师 ios,阴阳师手游ios,阴阳师手游安卓,阴阳师安卓,阴阳师 安卓,阴阳师ios,阴阳师 礼包,阴阳师礼包,阴阳师手游 安卓,阴阳师手游 礼包,阴阳师苹果,阴阳师攻略","share_m":"《阴阳师》手游式神录——茨木童子搭配使用攻略","share_m_2":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","share":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","skin":[{"name":"地狱鬼手","originator":"M<br/>i<br/>c<br/>h<br/>i<br/>H<br/>a<br/>n<br/>a"},{"name":"枫染秋色","originator":"雅アッシュ"},{"name":"青竹白雪","originator":null}]}];
let command = [];
command.push('#!/bin/bash');
command.push('mkdir -p ~/Downloads/阴阳师');
command.push('cd ~/Downloads/阴阳师');
for (let i in array) {
  let json = array[i];
  let id = json.id;
  let name = `${json.level}_${json.name}_${id}`;
  // 下载初始图片
  command.push(`curl https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_big_beforeAwake/${id}.png?v4 -o ${name}_初始.png`);
  // 下载觉醒图片
  command.push(`curl https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_big_afterAwake/${id}.png?v4 -o ${name}_觉醒.png`);
  // 下载皮肤
  if (!!json.skin && json.skin.length > 0) {
    for (let ski=1; ski<=json.skin.length; ski++) {
      command.push(`curl https://yys.res.netease.com/pc/zt/20161108171335/data/shishen_skin/${id}-${ski}.png?v4 -o ${name}_皮肤-${ski}.png`);
    }
  }
}

// 下载
function download(filename, text) {
    var pom = document.createElement('a');
    pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    pom.setAttribute('download', filename);
    if (document.createEvent) {
        var event = document.createEvent('MouseEvents');
        event.initEvent('click', true, true);
        pom.dispatchEvent(event);
    } else {
        pom.click();
    }
}
download("shishen.sh", command.join("\n"));
```
通过浏览器控制台，我们可以下载到[脚本文件](/yinyangshi/shishen.sh.txt)，chmod赋权后就可以愉快下载啦

## js 拼接信息到ES
ES中我们存储3个字段，ssId,name,level
```js
// 这里只放两个式神的数据测试
// let array = [{"id":"266","level":"SSR","name":"青行灯","pc_gonglve":"24478","pc_tongren":"24555","m_gonglve":"24632","m_tongren":"24709","hasVideo":"true","resource":"https://yys.res.netease.com/shishen/qingxingdengtr.zip","title":"《阴阳师》手游式神录_式神青行灯_青行灯攻略_青行灯御魂搭配攻略_觉醒材料_在哪里刷_青行灯阵容搭配_《阴阳师》手游官网","desc":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","keys":"阴阳师,手游,式神,青行灯,御魂,觉醒,攻略,培养,阵容,技能,资质,在哪里刷,升星,阴阳师式神,阴阳师下载,阴阳师官方下载,阴阳师安卓下载,阴阳师安卓官方下载,阴阳师手游,阴阳师礼包,阴阳师手游下载,阴阳师手游安卓, 阴阳师手游iOS,阴阳师手游苹果,阴阳师助手,网易手游,阴阳师手游 ios,阴阳师,阴阳师 ios,阴阳师手游ios,阴阳师手游安卓,阴阳师安卓,阴阳师 安卓,阴阳师ios,阴阳师 礼包,阴阳师礼包,阴阳师手游 安卓,阴阳师手游 礼包,阴阳师苹果,阴阳师攻略","share_m":"《阴阳师》手游式神录——青行灯搭配使用攻略","share_m_2":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","share":"《阴阳师》手游式神录，《阴阳师》手游青行灯御魂搭配攻略，青行灯在哪里刷，青行灯技能资质属性图鉴，青行灯觉醒材料需要什么？更多关于青行灯怎样玩的攻略请关注《阴阳师》手游官网。","skin":[{"name":"幽蝶花舞","originator":"红莲喵喵"},{"name":"青灯夜话","originator":null}]},{"id":"265","level":"SSR","name":"茨木童子","pc_gonglve":"23394","pc_tongren":"23398","m_gonglve":"23399","m_tongren":"23400","hasVideo":"true","resource":"https://yys.res.netease.com/shishen/cimutongzitr.zip","title":"《阴阳师》手游式神录_式神茨木童子_茨木童子攻略_茨木童子御魂搭配攻略_觉醒材料_在哪里刷_茨木童子阵容搭配_《阴阳师》手游官网","desc":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","keys":"阴阳师,手游,式神,茨木童子,御魂,觉醒,攻略,培养,阵容,技能,资质,在哪里刷,升星,阴阳师式神,阴阳师下载,阴阳师官方下载,阴阳师安卓下载,阴阳师安卓官方下载,阴阳师手游,阴阳师礼包,阴阳师手游下载,阴阳师手游安卓, 阴阳师手游iOS,阴阳师手游苹果,阴阳师助手,网易手游,阴阳师手游 ios,阴阳师,阴阳师 ios,阴阳师手游ios,阴阳师手游安卓,阴阳师安卓,阴阳师 安卓,阴阳师ios,阴阳师 礼包,阴阳师礼包,阴阳师手游 安卓,阴阳师手游 礼包,阴阳师苹果,阴阳师攻略","share_m":"《阴阳师》手游式神录——茨木童子搭配使用攻略","share_m_2":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","share":"《阴阳师》手游式神录，《阴阳师》手游茨木童子御魂搭配攻略，茨木童子在哪里刷，茨木童子技能资质属性图鉴，茨木童子觉醒材料需要什么？更多关于茨木童子怎样玩的攻略请关注《阴阳师》手游官网。","skin":[{"name":"地狱鬼手","originator":"M<br/>i<br/>c<br/>h<br/>i<br/>H<br/>a<br/>n<br/>a"},{"name":"枫染秋色","originator":"雅アッシュ"},{"name":"青竹白雪","originator":null}]}];

let list = [];
list.push('POST /yinyangshi/_doc/_bulk');
for (let i in array) {
  let json = array[i];
  let id = json.id;
  list.push(`{ "index" : {"_id": ${id}} }`);
  list.push(`{"ssId": ${id}, "name": \"${json.name}\", "level": \"${json.level}\"}`);
}

// 下载
function download(filename, text) {
    var pom = document.createElement('a');
    pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    pom.setAttribute('download', filename);
    if (document.createEvent) {
        var event = document.createEvent('MouseEvents');
        event.initEvent('click', true, true);
        pom.dispatchEvent(event);
    } else {
        pom.click();
    }
}
download("yys.txt", list.join("\n"));
```
